<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="Table.view.js"></script>
  <script type="text/javascript" src="Charts.view.js"></script>
  <script type="text/javascript" src="Bacen.js"></script>
  <script type="text/javascript" src="ExchangeRate.js"></script>
</head>
<body>

  <span>Data inicial</span>
  <input id="data_inicial_cotacao" type="date" autofocus>

  <span>Data final</span>
  <input id="data_final_cotacao" type="date">

  <button id="botao_cotacao"> Cotar</button>

  <div id="chart" style="width: 900px; height: 500px"></div>
  <div id="tabela"></div>

  <script>

    // Pega o valor do input 
    const getValueByTagId = id => document.getElementById(id).value;

    const converterData = date => {
      // converte um string de yyyy-mm-dd para mm-dd-yyyy
      const [ano, mes, dia] = date.split("-")
      return [mes, dia, ano].join("-")
    }

    const initializeFetch = async _ => {
      // Fução principal  
      const data_final = getValueByTagId("data_final_cotacao")
      const data_inicial = getValueByTagId("data_inicial_cotacao")
      const data_final_convertida = converterData(data_final)
      const data_inicial_convertida = converterData(data_inicial)
      
      const dados = await new ExchangeRate()
        .setPeriodos(data_inicial_convertida, data_final_convertida)
        .setTaxasDeCambio("EUR", "USD", "GBP")
        .getDados();

      drawTable("tabela", dados)
      drawCharts("chart", dados)
    }

    const drawCharts = (tagId, dados) => {
      const [nomes, valores] = dados
      const charts = new Charts();
      charts.setColumnsName(nomes)
      charts.setDadosAtBody(valores)
      charts.draw(tagId);
    }

    const drawTable = (tagId, dados) => {
      const [nomes, valores] = dados
      const tabela = new Table();
      tabela.setColumnsName(nomes)
      tabela.setDadosAtBody(valores)
      tabela.draw(tagId);
    }

    // Adiciona um evento, funcao que sera executada, ao clicar no botão. 
    const botao_cotacao = document.getElementById("botao_cotacao")
    botao_cotacao.addEventListener("click", initializeFetch) 

  </script>
</body>
</html>
